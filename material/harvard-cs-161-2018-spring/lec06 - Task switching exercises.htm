<!DOCTYPE html>
<!-- saved from url=(0057)https://read.seas.harvard.edu/cs161-18/lectures/lecture6/ -->
<html lang="en" class="gr__read_seas_harvard_edu"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="./lec06 - Task switching exercises_files/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <link rel="stylesheet" href="./lec06 - Task switching exercises_files/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
    <link rel="stylesheet" href="./lec06 - Task switching exercises_files/cs161.css">
    <title>Lecture 6 – CS 161 2018</title>
  <style type="text/css" id="d30de7f4-a4db-42e2-ad7c-87a2ab9454c8">.c3774e42-32c7-4465-a56f-fee5d5353b6d { position: relative !important; border-radius: 0.2em !important; padding: 0px !important; margin: 0px !important; }

.ad350197-c096-486f-b92f-87e8c8951c39 .ssh-close { position: absolute; left: -8px; top: -8px; width: 16px; height: 16px; z-index: 999; border: none; background: url("data:image/png;base64,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") no-repeat border-box; animation-duration: 275ms; animation-timing-function: ease-out; box-shadow: none; animation-name: c216529a-9d7d-41ef-96e0-e5f26293c550; }

.ad350197-c096-486f-b92f-87e8c8951c39 .ssh-close:hover, .ad350197-c096-486f-b92f-87e8c8951c39 .ssh-close:focus { background-image: url("data:image/png;base64,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"); }

@media print {
  .ad350197-c096-486f-b92f-87e8c8951c39 { box-shadow: unset !important; -webkit-print-color-adjust: exact !important; }
}

@keyframes c216529a-9d7d-41ef-96e0-e5f26293c550 { 
  0% { opacity: 0; transform: scale(0.6); }
  100% { opacity: 1; transform: scale(1); }
}

@keyframes cc2af1b5-cdd9-4f12-86b9-da4b3fdde05f { 
  100% { opacity: 0; transform: scale(0.3); }
}

.ad350197-c096-486f-b92f-87e8c8951c39 { background-color: rgba(238, 238, 238, 0.8); color: rgb(170, 170, 170); font: inherit; box-shadow: rgb(238, 238, 238) 0px 0px 0.35em; text-shadow: none !important; }

.default-red-aa94e3d5-ab2f-4205-b74e-18ce31c7c0ce { box-shadow: rgb(255, 128, 128) 0px 0px 0.35em; background-color: rgba(255, 128, 128, 0.8) !important; color: rgb(0, 0, 0) !important; }

.default-orange-da01945e-1964-4d27-8a6c-3331e1fe7f14 { box-shadow: rgb(255, 210, 170) 0px 0px 0.35em; background-color: rgba(255, 210, 170, 0.8) !important; color: rgb(0, 0, 0) !important; }

.default-yellow-aaddcf5c-0e41-4f83-8a64-58c91f7c6250 { box-shadow: rgb(255, 255, 170) 0px 0px 0.35em; background-color: rgba(255, 255, 170, 0.8) !important; color: rgb(0, 0, 0) !important; }

.default-green-c4d41e0a-e40f-4c3f-91ad-2d66481614c2 { box-shadow: rgb(170, 255, 170) 0px 0px 0.35em; background-color: rgba(170, 255, 170, 0.8) !important; color: rgb(0, 0, 0) !important; }

.default-cyan-f88e8827-e652-4d79-a9d9-f6c8b8ec9e2b { box-shadow: rgb(170, 255, 255) 0px 0px 0.35em; background-color: rgba(170, 255, 255, 0.8) !important; color: rgb(0, 0, 0) !important; }

.default-purple-c472dcdb-f2b8-41ab-bb1e-2fb293df172a { box-shadow: rgb(255, 170, 255) 0px 0px 0.35em; background-color: rgba(255, 170, 255, 0.8) !important; color: rgb(0, 0, 0) !important; }

.default-grey-da7cb902-89c6-46fe-b0e7-d3b35aaf237a { box-shadow: rgb(119, 119, 119) 0px 0px 0.35em; background-color: rgba(119, 119, 119, 0.8) !important; color: rgb(255, 255, 255) !important; }</style></head>
  <body data-gr-c-s-loaded="true">

<nav class="navbar navbar-expand-lg navbar-light">
  <a class="navbar-brand" href="https://read.seas.harvard.edu/cs161-18/">CS 161 2018</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture6/#" id="nav-dropdown-doc" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Documentation
    </a>
    <div class="dropdown-menu" aria-labelledby="nav-dropdown-doc">
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/doc/cplusplus/">C++</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/doc/lists/">Lists</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/doc/memory-layout/">Memory layout</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/doc/contexts/">Contexts</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/doc/memory-iterators/">Memory iterators</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/doc/spinlocks/">Spinlocks</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/doc/synchronization-invariants/">Synchronization invariants</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/doc/chickadeefs/">ChickadeeFS</a>
    
    </div>
  </li>

      
  <li class="nav-item">
    
      <a class="nav-link" href="https://read.seas.harvard.edu/cs161-18/schedule/">Schedule</a>
    
  </li>

      
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture6/#" id="nav-dropdown-psets" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Problem sets
    </a>
    <div class="dropdown-menu" aria-labelledby="nav-dropdown-psets">
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/pset1/">Problem set 1</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/pset2/">Problem set 2</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/pset3/">Problem set 3</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/pset4/">Problem set 4</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/pset5/">Problem set 5</a>
    
    </div>
  </li>

      
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture6/#" id="nav-dropdown-lectures" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Lectures
    </a>
    <div class="dropdown-menu" aria-labelledby="nav-dropdown-lectures">
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture2/">Lecture 2</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture3/">Lecture 3</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture4/">Lecture 4</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture5/">Lecture 5</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture6/">Lecture 6</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture7/">Lecture 7</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture8/">Lecture 8</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture9/">Lecture 9</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture10/">Lecture 10</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture11/">Lecture 11</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture12/">Lecture 12</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture14/">Lecture 14</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture15/">Lecture 15</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture16/">Lecture 16</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture17/">Lecture 17</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture18/">Lecture 18</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture19/">Lecture 19</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture20/">Lecture 20</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture21/">Lecture 21</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture22/">Lecture 22</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture23/">Lecture 23</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture24/">Lecture 24</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture25/">Lecture 25</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/lectures/papers/">Papers</a>
    
    </div>
  </li>

      
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" href="https://read.seas.harvard.edu/cs161-18/lectures/lecture6/#" id="nav-dropdown-sections" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Sections
    </a>
    <div class="dropdown-menu" aria-labelledby="nav-dropdown-sections">
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/sections/section1/">Section 1</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/sections/section2/">Section 2</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/sections/section3/">Section 3</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/sections/section4/">Section 4</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/sections/section5/">Section 5</a>
    
      <a class="dropdown-item" href="https://read.seas.harvard.edu/cs161-18/sections/section6/">Section 6</a>
    
    </div>
  </li>

    </ul>
  </div>
</nav>


<div class="container">
    <h1><a href="https://read.seas.harvard.edu/cs161-18/lectures/lecture6/">Lecture 6</a></h1>
    <div class="post">
        <h2 id="chickadee-bugs">Chickadee bugs</h2>

<p>What potential bug was addressed by <a href="https://github.com/CS161/chickadee/commit/d12e98cdb959bb9cdb85fc8e1b0878733026388e">commit d12e98cdb959bb9cdb85fc8e1b0878733026388e</a>?
Describe a possible execution of the old code that could violate some kernel
invariant or otherwise cause a problem.</p>

<div class="has-solution"><blockquote class="solution-collapsed js-solution show"><a href="https://read.seas.harvard.edu/cs161-18/lectures/lecture6/" class="js-solution show">Show solution</a></blockquote><blockquote class="hidden solution">
<p>The old code violates a Chickadee invariant, which is that the currently
running process’s <code>yields_</code> and <code>regs_</code> can be set <strong>only</strong> when interrupts
are disabled, and <strong>only</strong> immediately before calling <code>cpustate::schedule()</code>.
Violations of this invariant can cause lost wakeups and crashes.</p>

<h4 id="a-working-example-of-nested-resumption-states">A working example of nested resumption states</h4>

<p>When a Chickadee context switch or exception occurs, Chickadee saves
<em>resumption state</em> on the relevant kernel task stack. Because kernel tasks
are suspendable, this resumption state can be nested. For example, this can
happen:</p>

<ol>
<li>A process makes a system call. The architecture disables interrupts and
jumps to <code>syscall_entry</code>.</li>
<li><code>syscall_entry</code> saves <code>regstate</code> resumption state on the stack and calls
<code>proc::syscall</code>.</li>
<li>The system call implementation enables interrupts and later calls <code>proc::yield</code>.</li>
<li><code>proc::yield</code> saves <code>yieldstate</code> resumption state on the stack.</li>
<li><strong>Before it finishes</strong>, an interrupt occurs. The architecture disables
interrupts and jumps to <code>exception_entry</code>.</li>
<li><code>exception_entry</code> saves new <code>regstate</code> resumption state on the
stack and calls <code>proc::exception</code>.</li>
<li><code>proc::exception</code> calls <code>proc::yield</code>.</li>
<li><code>proc::yield</code> saves <code>yieldstate</code> resumption state on the stack.</li>
</ol>

<p></p><figure class="tall"><img src="./lec06 - Task switching exercises_files/lec06-nestresume.png" alt="Proc state"></figure><p></p>

<ol start="9">
<li><code>proc::yield</code> stores a pointer to that <code>yieldstate</code> in the <code>proc::yields_</code>
member, disables interrupts, and switches to the <code>cpustate</code> stack.</li>
</ol>

<p></p><figure class="tall"><img src="./lec06 - Task switching exercises_files/lec06-nestresume2.png" alt="Proc state"></figure><p></p>

<p>Only in step 9 does the kernel change to another stack (first the CPU stack,
and then, potentially, another kernel task stack). That’s why step 9 stores
a pointer to the resumption state in a known place (<code>proc::yields_</code>). Until
step 9, <code>%rsp</code> and local variables suffice to tell the kernel
where to resume.</p>

<p>Later, when the kernel resumes the yielded process, steps 5–8 will be undone.</p>

<ol start="10">
<li>(undoes 8) <code>proc::resume</code> loads <code>%rsp</code> with the value stored in
<code>proc::yields_</code>, erases <code>proc::yields_</code>, pops callee-saved registers
from the on-stack <code>yieldstate</code>,
and executes the <code>retq</code> instruction.</li>
<li>(undoes 7) That returns to <code>proc::exception</code>. Assume
<code>proc::exception</code> then returns.</li>
<li>(undoes 6) The second half of <code>exception_entry</code> reloads registers from
the on-stack <code>regstate</code> and…</li>
<li>(undoes 5) executes <code>iretq</code>.</li>
</ol>

<p>At this point, the <code>proc::yield</code> execution resumes. The process is going to
sleep again! This shouldn’t be a problem—and it isn’t.</p>

<ol start="14">
<li><code>proc::yield</code> stores a pointer to the <code>yieldstate</code> in the
<code>proc::yields_</code> member, disables interrupts, and switches to the
<code>cpustate</code> stack.</li>
</ol>

<p></p><figure class="tall"><img src="./lec06 - Task switching exercises_files/lec06-nestresume3.png" alt="Proc state"></figure><p></p>

<p>Later, when the kernel resumes the re-yielded process <em>again</em>, steps 1–4 are undone.</p>

<ol start="15">
<li>(undoes 14 and 4) <code>proc::resume</code> loads <code>%rsp</code> with the value
stored in <code>proc::yields_</code>, pops callee-saved registers, and executes
<code>retq</code>.</li>
<li>(undoes 3) That returns to <code>proc::syscall</code>. Assume <code>proc::syscall</code> then
returns.</li>
<li>(undoes 2) The second half of <code>syscall_entry</code> skips over the on-stack
<code>regstate</code> and…</li>
<li>(undoes 1) executes <code>iretq</code>.</li>
</ol>

<p>And the process resumes.</p>

<h4 id="a-problematic-execution">A problematic execution</h4>

<p>This is the old yield code:</p>

<div class="githubref"><a href="https://github.com/CS161/chickadee/blob/pset1-2018/k-exception.S#L217">k-exception.S:217</a></div>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm">       <span style="">//</span> <span style="color:#06287e">store</span> <span style="color:#60add5">yieldstate</span> <span style="color:#60add5">pointer</span>
       <span style="color:#06287e">movq</span> <span style="color:#bb60d5">%rsp</span>, <span style="color:#40a070">16</span>(<span style="color:#bb60d5">%rdi</span>)

       <span style="">//</span> <span style="color:#06287e">disable</span> <span style="color:#60add5">interrupts</span>, <span style="color:#60add5">switch</span> <span style="color:#60add5">to</span> <span style="color:#60add5">cpustack</span>
       <span style="color:#06287e">cli</span>
       <span style="color:#06287e">movq</span> <span style="color:#bb60d5">%rdi</span>, <span style="color:#bb60d5">%rsi</span>
       <span style="color:#06287e">movq</span> <span style="color:#bb60d5">%gs</span>:(<span style="color:#40a070">0</span>), <span style="color:#bb60d5">%rdi</span>
       <span style="color:#06287e">leaq</span> <span style="color:#60add5">CPUSTACK_SIZE</span>(<span style="color:#bb60d5">%rdi</span>), <span style="color:#bb60d5">%rsp</span>

       <span style="">//</span> <span style="color:#06287e">call</span> <span style="color:#60add5">scheduler</span>
       <span style="color:#06287e">jmp</span> <span style="color:#60add5">_ZN8cpustate8scheduleEP4proc</span></code></pre></div>
<p>The problem triggers when an interrupt occurs <em>immediately before <code>cli</code></em>.
<code>exception_entry</code> will store a <code>regstate</code>, and <code>proc::exception</code> will
execute, with <code>yields_</code> set to a non-null value. That’s already weird, but things really
go wrong if <code>proc::exception</code> then calls <code>proc::yield</code>. The second <code>proc::yield</code>
call <em>overwrites</em> the stored <code>yields_</code>:</p>

<p></p><figure class="tall"><img src="./lec06 - Task switching exercises_files/lec06-nestresume4.png" alt="Proc state"></figure><p></p>

<p>And the overwritten <code>yields_</code> is never recovered.
Eventually there will be no place for the process to resume!</p>

<p></p><figure class="tall"><img src="./lec06 - Task switching exercises_files/lec06-nestresume5.png" alt="Proc state"></figure><p></p>

<h4 id="fixing-it">Fixing it</h4>

<p>In the revised, correct implementation, <code>yields_</code> is set <em>after</em>
interrupts are disabled. As a result, no exception will overwrite <code>yields_</code>
unexpectedly, and the process always resumes at the correct place.</p>
<p><a href="https://read.seas.harvard.edu/cs161-18/lectures/lecture6/" class="js-solution hide">Hide solution</a></p></blockquote></div>

<h2 id="syscall-registers"><code>syscall</code> registers</h2>

<p>The <code>syscall</code> entry point saves most registers to a <code>struct regstate</code>. But is that
really necessary? For instance, the <em>callee-saved</em> registers, such as
<code>%rbx</code> and <code>%r12</code>, will be saved and restored by kernel C++ code
<em>automatically</em>, since the C++ compiler uses  the normal x86-64 calling
convention. (For this reason, <code>syscall_entry</code> doesn’t bother to restore those
registers when it resumes the user process!)</p>

<p>Which registers must <code>syscall_entry</code> save to <code>struct regstate</code> for Chickadee
to work correctly? Run experiments to see, and explain the results.</p>

<div class="has-solution"><blockquote class="solution-collapsed js-solution show"><a href="https://read.seas.harvard.edu/cs161-18/lectures/lecture6/" class="js-solution show">Show solution</a></blockquote><blockquote class="hidden solution">
<p>First, <code>syscall_entry</code> must save all the registers used for system call
arguments. This is because <code>proc::syscall</code> reads the system call arguments
out of its <code>regstate*</code> argument. In current Chickadee, there are only two
such registers, <code>%rax</code> (used for the system call number) and <code>%rdi</code> (the
address argument for <code>SYSCALL_PAGE_ALLOC</code>), but obviously for more complex
system calls there will be more.</p>

<p>Second, <code>syscall_entry</code> <em>must</em> save the callee-saved registers, <em>even
though</em> in the normal case the C++ compiler will save and restore them too
(making the initial save seem redundant). The reason is <code>fork</code>. The
<code>SYSCALL_FORK</code> implementation initializes the child process’s registers with
a copy of the parent’s registers, <em>which are obtained through the
<code>regstate* regs</code> argument</em>. Although the calling convention says most of those
registers are garbage, the callee-saved registers in the child must have the
values from the parent, or the child will go wrong. So the <code>regs</code> must
save those registers.</p>
<p><a href="https://read.seas.harvard.edu/cs161-18/lectures/lecture6/" class="js-solution hide">Hide solution</a></p></blockquote></div>

<h2 id="ucontext"><code>ucontext</code></h2>

<p>On Linux or Mac, read the manual pages for <code>getcontext</code>, <code>setcontext</code>,
<code>makecontext</code>, and <code>swapcontext</code>. What are the closest-corresponding Chickadee
functions? Roughly how will these functions be implemented? Which of them, if
any, can be implemented entirely within the C abstract machine (as opposed to
using assembly)?</p>

<div class="has-solution"><blockquote class="solution-collapsed js-solution show"><a href="https://read.seas.harvard.edu/cs161-18/lectures/lecture6/" class="js-solution show">Show solution</a></blockquote><blockquote class="hidden solution">
<p>These functions have the following rough specifications:</p>

<ul>
<li><code>getcontext(ucp)</code> — Saves the current thread context in <code>*ucp</code>.</li>
<li><code>setcontext(ucp)</code> — Replaces the current thread context with <code>*ucp</code>. I.e.,
restarts the <code>ucp</code> context.</li>
<li><code>makecontext(ucp, func, ...)</code> — Initializes <code>*ucp</code> as a new context that will
execute <code>func</code>.</li>

<li><p><code>swapcontext(ucp1, ucp2)</code> — “Atomically” swaps two contexts. This behaves
sort of like <code>getcontext(ucp1); setcontext(ucp2)</code>; more completely,
though, it behaves like this:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#902000">int</span> <span style="color:#06287e">swapcontext</span>(ucontext_t<span style="color:#666">*</span> ucp1, ucontext_t<span style="color:#666">*</span> ucp2) {
    <span style="color:#007020;font-weight:bold">volatile</span> <span style="color:#902000">bool</span> swapped <span style="color:#666">=</span> <span style="color:#007020">false</span>; <span style="color:#60a0b0;font-style:italic">// don’t store in a register!
</span><span style="color:#60a0b0;font-style:italic"></span>    <span style="color:#902000">int</span> r <span style="color:#666">=</span> getcontext(ucp1);
    <span style="color:#007020;font-weight:bold">if</span> (r <span style="color:#666">==</span> <span style="color:#40a070">0</span> <span style="color:#666">&amp;&amp;</span> swapped <span style="color:#666">==</span> <span style="color:#007020">false</span>) {
        swapped <span style="color:#666">=</span> <span style="color:#007020">true</span>;         <span style="color:#60a0b0;font-style:italic">// next `setcontext(ucp1)` shouldn’t swap
</span><span style="color:#60a0b0;font-style:italic"></span>        r <span style="color:#666">=</span> setcontext(ucp2);   <span style="color:#60a0b0;font-style:italic">// only returns on error
</span><span style="color:#60a0b0;font-style:italic"></span>    }
    <span style="color:#007020;font-weight:bold">return</span> r;
}
</code></pre></div></li>
</ul>

<p>Note that the <code>ucontext</code> functions all involve <em>voluntary</em> context switches.</p>

<p>As for Chickadee:</p>

<ul>
<li>A <code>ucontext_t</code> contains context information, including a stack pointer and
registers. In Chickadee, <code>proc</code> contains context information.</li>
<li><code>proc::resume</code> restarts a <code>proc</code> where it left off, and is therefore
like <code>setcontext</code>.</li>
<li><code>proc::yield</code> does the equivalent of <code>getcontext</code>, but
always switches to the CPU scheduler afterwards. It’s sort of like a
<code>swapcontext</code> with the second argument fixed to <code>cpustate::schedule</code>.</li>
<li><code>proc::init_kernel</code> is the closest match to <code>makecontext</code>. It initializes
a <code>proc</code> context to start running a kernel function.</li>
</ul>

<p>To write the <code>ucontext</code> functions, you’d need to perform the same tasks as
Chickadee. A <code>ucontext</code> function will need to save and/or restore registers
and stack pointer, for example. The <code>makecontext</code> and <code>swapcontext</code>
functions can likely be implemented entirely in the C abstract machine:
<code>swapcontext</code> is implemented above, and <code>makecontext</code> simply initializes C
structures, much as <code>proc::init_kernel</code> does. You need to escape to assembly
specifically to save or restore registers and stack pointer state.</p>

<p>It can be fun to look at real implementations of these functions. For instance,
here are some from <a href="https://www.gnu.org/s/libc/">glibc, the GNU C library</a>:</p>

<ul>
<li><a href="https://github.com/bminor/glibc/blob/master/sysdeps/unix/sysv/linux/x86_64/swapcontext.S">x86-64 swapcontext.S</a></li>
<li><a href="https://github.com/bminor/glibc/blob/master/sysdeps/unix/sysv/linux/x86_64/getcontext.S">x86-64 getcontext.S</a></li>
<li><a href="https://github.com/bminor/glibc/blob/master/sysdeps/unix/sysv/linux/x86_64/setcontext.S">x86-64 setcontext.S</a></li>
<li><a href="https://github.com/bminor/glibc/blob/master/sysdeps/unix/sysv/linux/x86_64/makecontext.c">x86-64 makecontext.c</a></li>
</ul>

<p>(I don’t know why <code>swapcontext</code> is implemented in assembly rather than C.
Maybe an efficiency thing. Can you figure it out?)</p>

<h4 id="a-note-on-c-libraries">A note on C libraries</h4>

<p>We generally recommend looking at <a href="http://www.musl-libc.org/">musl libc</a> <a href="https://github.com/ifduyue/musl">(GitHub
mirror)</a>, which is an efficient, modern,
standards-conformant, and lightweight implementation of the C standard
library. Most other C libraries are enormous and hard to read by comparison.
Although glibc is widely deployed, it’s larger, older, and
used to be buggy and hamstrung by <a href="https://en.wikipedia.org/wiki/GNU_C_Library#History">toxic project
leadership</a>
[<a href="https://blog.aurel32.net/47">1</a>, <a href="https://blog.aurel32.net/175">2</a>].
Unfortunately musl doesn’t implement the <code>ucontext</code> functions because they
have been removed from recent C standards.</p>
<p><a href="https://read.seas.harvard.edu/cs161-18/lectures/lecture6/" class="js-solution hide">Hide solution</a></p></blockquote></div>

<h2 id="exit-design">Exit design</h2>

<p><a href="https://read.seas.harvard.edu/cs161-18/pset2#b-exit">Problem Set 2, Part B</a> asks you to implement part of a <code>sys_exit</code>
system call. One of the invariants mentioned says that “The kernel task
responsible for the exiting process must delegate its final freeing to some
other logical thread of execution”. Come up with an initial design for this
delegation.</p>

<div class="has-solution"><blockquote class="solution-collapsed js-solution show"><a href="https://read.seas.harvard.edu/cs161-18/lectures/lecture6/" class="js-solution show">Show solution</a></blockquote><blockquote class="hidden solution">
<p>We recommend having a process set its state (<code>proc::state_</code>) to some
constant that means “in the process of exiting”, and then having the CPU
scheduler, <code>cpustate::schedule()</code>, or perhaps an idle task complete the
free.</p>
<p><a href="https://read.seas.harvard.edu/cs161-18/lectures/lecture6/" class="js-solution hide">Hide solution</a></p></blockquote></div>

    </div>
</div>

        <script src="./lec06 - Task switching exercises_files/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="./lec06 - Task switching exercises_files/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
        <script src="./lec06 - Task switching exercises_files/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
        <script src="./lec06 - Task switching exercises_files/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
        <script>(function () {
        $(".math").each(function () {
            var t = this.innerText,
                opt = {throwOnError: false, displayMode: t.substr(0, 2) === "\\["};
            katex.render(t.replace(/(?:^\\\(|^\\\[|\\\)$|\\\]$)/g, ""), this, opt);
        });
        function sol_toggle(sol, hide, storage) {
            sol.childNodes[0].classList.toggle("hidden", !hide);
            sol.childNodes[0].classList.toggle("shown", hide);
            sol.childNodes[1].classList.toggle("hidden", hide);
            sol.childNodes[1].classList.toggle("shown", !hide);
            if (storage) {
                var key = location.href + " " + $(".has-solution").index(sol);
                if (hide)
                    sessionStorage.removeItem(key);
                else
                    sessionStorage.setItem(key, true);
            }
        }
        $(".solution").each(function () {
            $(this).wrap('<div class="has-solution"></div>');
            var sol = this.parentElement;
            $(sol).prepend('<blockquote class="solution-collapsed js-solution show"><a href="" class="js-solution show"></a></blockquote>');
            $(this).append('<p><a href="" class="js-solution hide"></a></p>');
            $(sol).find("a.js-solution.show").text(this.getAttribute("data-show-text") || "Show solution");
            $(sol).find("a.js-solution.hide").text(this.getAttribute("data-hide-text") || "Hide solution");
            var key = location.href + " " + $(".has-solution").index(sol);
            if (sessionStorage.getItem(key))
                sol_toggle(sol, false, false);
        });
        $(document).on("click", ".js-solution", function (event) {
            var sol = $(this).closest(".has-solution")[0];
            sol_toggle(sol, this.classList.contains("hide"), true);
            event.preventDefault();
        });
        })()</script>
    


</body></html>